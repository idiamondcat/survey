"use strict";(self.webpackChunksurvey=self.webpackChunksurvey||[]).push([[35],{6035:(W,w,p)=>{p.r(w),p.d(w,{QuestionComponent:()=>B});var y=p(177),j=p(60),G=p(614),d=p(4341),t=p(4438);let q=(()=>{class o{constructor(e){this.cd=e,this.progress=0,this.questionCount=0}ngOnChanges(e){e.progress&&(this.progress=e.progress.currentValue)}static#t=this.\u0275fac=function(i){return new(i||o)(t.rXU(t.gRc))};static#e=this.\u0275cmp=t.VBU({type:o,selectors:[["app-indicator"]],inputs:{progress:"progress",questionCount:"questionCount"},standalone:!0,features:[t.OA$,t.aNF],decls:5,vars:4,consts:[[1,"indicator"],[1,"indicator__step"],[1,"indicator__elem"],[1,"indicator__indicator"]],template:function(i,n){1&i&&(t.j41(0,"div",0)(1,"p",1),t.EFF(2),t.k0s(),t.j41(3,"div",2),t.nrm(4,"div",3),t.k0s()()),2&i&&(t.R7$(2),t.Lme("",n.progress," \u0438\u0437 ",n.questionCount,""),t.R7$(2),t.xc7("width",n.progress/n.questionCount*100,"%"))},styles:["[_ngcontent-%COMP%]:root{width:100%}.indicator__elem[_ngcontent-%COMP%]{height:15px;display:flex;flex-direction:column;row-gap:5px;border-radius:8px;border:2px solid #F1F3F9}.indicator__indicator[_ngcontent-%COMP%]{height:100%;background-color:#dafb59;border-radius:4px}.indicator__step[_ngcontent-%COMP%]{margin:0}"],changeDetection:0})}return o})();var F=p(5617),N=p(6354),X=p(6372),R=p(1951);let k=(()=>{class o extends F.jh{constructor(e,i){super({isLoading:!1,currentSectionIndex:0,currentQuestionIndex:0,answeredQuestions:{},weight:{},survey:null,questionStack:[]}),this.surveyService=e,this.router=i,this.currentSection$=this.select(n=>n.survey?n.survey.sections[n.currentSectionIndex]:null),this.isLoading$=this.select(n=>n.isLoading),this.currentQuestion$=this.select(n=>n.survey?n.survey.sections[n.currentSectionIndex].questions[n.currentQuestionIndex]:null),this.answeredQuestions$=this.select(n=>n.answeredQuestions),this.weight$=this.select(n=>n.weight),this.survey$=this.select(n=>n.survey),this.vm$=this.select({isLoading:this.isLoading$,currentSection:this.currentSection$,currentQuestion:this.currentQuestion$,answeredQuestions:this.answeredQuestions$,weight:this.weight$,survey:this.survey$}),this.loadSurvey=this.effect(n=>n.pipe((0,N.T)(()=>{this.patchState({survey:this.surveyService.surveyData.value})}))),this.nextQuestion=this.updater((n,s)=>{const{currentSectionIndex:a,currentQuestionIndex:c,survey:r,answeredQuestions:l,questionStack:_,weight:z}=n;if(!r)return n;const f=r.sections[a].questions[c],U={...l,...s},S=Object.values(s)[0];let C,v,x,g,b,Q;switch(b=a,Q=c+1,f.type){case"checkbox":let m=f.answers.filter(u=>-1!==S.indexOf(u.answerId));v=f.answers.filter(u=>Object.values(l).flat().includes(u.answerId)),C=m,g=m.every(u=>u.nextCardNumber===m[0].nextCardNumber)?m[0].nextCardNumber:String(Math.max(...m.map(u=>Number(u.nextCardNumber))));break;case"radio":C=f.answers.find(u=>u.answerId?u.answerId===S:u),v=f.answers.find(u=>Object.values(l).flat().includes(u.answerId)),g=C?.nextCardNumber;break;default:(!g||f)&&(C=null,v=null,g=Number(f.id+1).toString())}if(x=this.checkObj(z,C,v),r.sections.some((m,u)=>{const $=m.questions.findIndex(K=>K.id===g);return-1!==$&&(u!==a&&(this.patchState({isLoading:!0}),setTimeout(()=>{this.patchState({isLoading:!1})},5e3)),b=u,Q=$,!0)}),f.lastCard){const m={weights:x};return this.patchState({isLoading:!0}),this.surveyService.postData(m).subscribe({next:u=>{this.patchState({isLoading:!1}),console.log(u),this.router.navigate(["/results"])},error:u=>{console.log(u.message)}}),n}return{...n,answeredQuestions:U,weight:x,currentSectionIndex:b,currentQuestionIndex:Q,questionStack:[..._,{sectionIndex:a,questionIndex:c}]}}),this.prevQuestion=this.updater((n,s)=>{const{questionStack:a,answeredQuestions:c}=n,r={...c,...s};if(0===a.length)return n;const l=a.pop();return{...n,answeredQuestions:r,currentSectionIndex:l.sectionIndex,currentQuestionIndex:l.questionIndex,questionStack:a}})}checkObj(e,i,n){const s={...e};return n&&Array.isArray(n)&&n.forEach(a=>{let{weight:c}=a;if(0!==c){const r=c;Object.keys(r).forEach(_=>{_ in s&&(s[_]=s[_]-r[_],0===s[_]&&delete s[`${_}`])})}}),i&&Array.isArray(i)&&i.forEach(a=>{let{weight:c}=a;if(0!==c){const r=c;Object.keys(r).forEach(l=>{s[l]=l in s?s[l]+r[l]:r[l]})}}),s}static#t=this.\u0275fac=function(i){return new(i||o)(t.KVO(X.I),t.KVO(R.Ix))};static#e=this.\u0275prov=t.jDH({token:o,factory:o.\u0275fac})}return o})();const I=o=>({error:o});function M(o,h){if(1&o&&(t.j41(0,"div",0)(1,"div",1),t.nrm(2,"div",2),t.j41(3,"h1",3),t.EFF(4),t.k0s()()()),2&o){const e=t.XpG();t.R7$(4),t.SpI(" ",null==e.currentSection?null:e.currentSection.title," ")}}function T(o,h){if(1&o){const e=t.RV6();t.j41(0,"label")(1,"input",14),t.bIt("change",function(){const n=t.eBV(e).$implicit,s=t.XpG(4),a=t.XpG();return t.Njj(a.onRadioChange(s.currentQuestion.id,n.answerId))}),t.k0s(),t.j41(2,"div",15)(3,"span"),t.EFF(4),t.k0s()()()}if(2&o){let e;const i=h.$implicit,n=t.XpG(4),s=t.XpG();t.R7$(),t.Y8G("name",n.currentQuestion.id)("formControlName",n.currentQuestion.id)("value",i.answerId)("placeholder",null==i?null:i.placeholder)("checked",i.answerId===(null==(e=s.form.get(n.currentQuestion.id))?null:e.value)),t.R7$(3),t.JRh(null==i?null:i.text)}}function O(o,h){if(1&o&&t.Z7z(0,T,5,6,"label",null,t.fX1),2&o){const e=t.XpG(3);t.Dyx(e.currentQuestion.answers)}}function E(o,h){if(1&o){const e=t.RV6();t.j41(0,"label",16)(1,"input",17),t.bIt("change",function(n){const s=t.eBV(e).$implicit,a=t.XpG(4),c=t.XpG();return t.Njj(c.onCheckboxChange(a.currentQuestion.id,n,s.answerId))}),t.k0s(),t.j41(2,"div",18),t.nrm(3,"fa-icon",19),t.j41(4,"span"),t.EFF(5),t.k0s()()()}if(2&o){const e=h.$implicit,i=h.$index,n=t.XpG(4),s=t.XpG();t.Y8G("formArrayName",n.currentQuestion.id),t.R7$(),t.Y8G("formControlName",i)("value",e.answerId)("placeholder",null==e?null:e.placeholder),t.R7$(2),t.Y8G("icon",s.faCircleCheck),t.R7$(2),t.JRh(null==e?null:e.text)}}function V(o,h){if(1&o&&t.Z7z(0,E,6,6,"label",16,t.fX1),2&o){const e=t.XpG(3);t.Dyx(e.currentQuestion.answers)}}function A(o,h){if(1&o&&t.nrm(0,"textarea",20),2&o){let e;const i=t.XpG(4),n=t.XpG();t.Y8G("ngClass",t.eq3(2,I,(null==(e=n.form.get(i.currentQuestion.id))?null:e.invalid)&&(null==(e=n.form.get(i.currentQuestion.id))?null:e.touched)))("formControlName",i.currentQuestion.id)}}function D(o,h){if(1&o&&t.nrm(0,"input",21),2&o){let e;const i=t.XpG(4),n=t.XpG();t.Y8G("ngClass",t.eq3(3,I,(null==(e=n.form.get(i.currentQuestion.id))?null:e.invalid)&&(null==(e=n.form.get(i.currentQuestion.id))?null:e.touched)))("type",i.currentQuestion.type)("formControlName",i.currentQuestion.id)}}function P(o,h){if(1&o&&t.DNE(0,A,1,4,"textarea",20)(1,D,1,5),2&o){const e=t.XpG(3);t.vxM(0,"textArea"===e.currentQuestion.type?0:1)}}function Y(o,h){if(1&o){const e=t.RV6();t.j41(0,"p",8),t.EFF(1),t.k0s(),t.j41(2,"form",9)(3,"fieldset",10),t.DNE(4,O,2,0)(5,V,2,0)(6,P,2,1),t.k0s(),t.j41(7,"div",11)(8,"button",12),t.bIt("click",function(){t.eBV(e);const n=t.XpG(3);return t.Njj(n.prevQuestion())}),t.EFF(9,"\u041d\u0430\u0437\u0430\u0434"),t.k0s(),t.j41(10,"button",13),t.bIt("click",function(){t.eBV(e);const n=t.XpG(3);return t.Njj(n.nextQuestion())}),t.EFF(11,"\u0414\u0430\u043b\u0435\u0435"),t.k0s()()()}if(2&o){let e;const i=t.XpG(2),n=t.XpG();t.R7$(),t.JRh(i.currentQuestion.question),t.R7$(),t.Y8G("formGroup",n.form),t.R7$(2),t.vxM(4,"radio"===(e=i.currentQuestion.type)?4:"checkbox"===e?5:6),t.R7$(6),t.Y8G("disabled",!n.form.valid)}}function J(o,h){if(1&o&&(t.j41(0,"div",4)(1,"div",5),t.nrm(2,"app-indicator",6),t.j41(3,"div",7),t.DNE(4,Y,12,4),t.k0s()()()),2&o){const e=t.XpG(),i=t.XpG();t.R7$(2),t.Y8G("progress",i.progress)("questionCount",i.questionCount),t.R7$(2),t.vxM(4,e.currentQuestion?4:-1)}}function L(o,h){1&o&&t.DNE(0,M,5,1,"div",0)(1,J,5,3),2&o&&t.vxM(0,h.isLoading?0:1)}let B=(()=>{class o{constructor(e,i,n){this.cd=e,this.surveyStore=i,this.fb=n,this.vm$=this.surveyStore.vm$,this.faCircleCheck=G.QRE,this.questionCount=0,this.answeredQuestionCount=0,this.progress=0}ngOnInit(){this.surveyStore.loadSurvey(),this.vm$.subscribe(e=>{e.currentQuestion?(this.initializeCurrForm(e.currentQuestion,e.answeredQuestions),this.cd.detectChanges()):this.form=this.fb.group({}),e.survey&&(this.questionCount=e.survey.sections.reduce((i,n)=>i+n.questions.length,0)),this.cd.markForCheck()})}prevQuestion(){this.progress>0&&this.progress<this.questionCount&&(this.surveyStore.prevQuestion(this.form.value),this.progress=Math.max(0,this.progress-1))}nextQuestion(){this.progress<this.questionCount&&(this.surveyStore.nextQuestion(this.form.value),this.progress=Math.min(this.questionCount,this.progress+1))}initializeCurrForm(e,i){const n=e.answers;switch(e.type){case"radio":this.createRadio(e.id,n,i);break;case"checkbox":this.createCheckbox(e,i);break;default:this.createTextField(e.id,e.type,i)}}onRadioChange(e,i){this.form.get(e)?.setValue(i),this.cd.detectChanges()}onCheckboxChange(e,i,n){const s=this.form.get(String(e));let c;if(i.target.checked)s.controls.some(r=>r.value===n)||s.push(new d.MJ(n));else{const r=s.controls.findIndex(l=>l.value===n);-1!==r&&s.removeAt(r)}for(c=s.controls.filter(r=>"string"==typeof r.value).map(r=>r);0!==s.length;)s.removeAt(0);c.forEach(r=>s.push(r)),this.cd.detectChanges()}createTextField(e,i,n){const s={};return s[e]=new d.MJ(n[e]||"",[d.k0.required]),this.form=this.fb.group(s),this.form}createRadio(e,i,n){const s={};return i.forEach(a=>{let c=n[e]||"";c||(c=a.answerId),s[e]||(s[e]=new d.MJ(c,d.k0.required))}),this.form=this.fb.group(s),this.form}createCheckbox(e,i){const{id:n,answers:s}=e,a=String(n),c=this.fb.array([]);s.forEach(l=>{let _=!!i[a]?.includes(l.answerId)&&l.answerId;c.push(new d.MJ(_))});const r={};return r[a]=c,this.form=this.fb.group(r),this.form}static#t=this.\u0275fac=function(i){return new(i||o)(t.rXU(t.gRc),t.rXU(k),t.rXU(d.ok))};static#e=this.\u0275cmp=t.VBU({type:o,selectors:[["app-question"]],standalone:!0,features:[t.Jv_([k]),t.aNF],decls:2,vars:3,consts:[[1,"preloader"],[1,"preloader__wrapper"],[1,"preloader__img"],[1,"preloader__title"],[1,"container"],[1,"question"],[3,"progress","questionCount"],[1,"question__elem"],[1,"question__text"],[3,"formGroup"],[1,"question__wrapper"],[1,"question__btn-wrapper"],[1,"btn","btn--back",3,"click"],[1,"btn","btn--forward",3,"click","disabled"],["type","radio",1,"radio",3,"change","name","formControlName","value","placeholder","checked"],[1,"radio-indicator"],[3,"formArrayName"],["type","checkbox",1,"checkbox",3,"change","formControlName","value","placeholder"],[1,"checkbox-indicator"],[1,"checkbox-indicator__icon",3,"icon"],["rows","4","required","",1,"field",3,"ngClass","formControlName"],["required","",1,"field",3,"ngClass","type","formControlName"]],template:function(i,n){if(1&i&&(t.DNE(0,L,2,1),t.nI1(1,"async")),2&i){let s;t.vxM(0,(s=t.bMT(1,1,n.vm$))?0:-1,s)}},dependencies:[y.YU,j.aY,y.Jj,d.X1,d.qT,d.me,d.Zm,d.Fm,d.BC,d.cb,d.YS,d.j4,d.JD,d.v8,q],styles:[".question[_ngcontent-%COMP%]{max-width:500px;margin:115px auto 0;display:flex;flex-direction:column;row-gap:73px}.question__wrapper[_ngcontent-%COMP%]{width:100%;padding:0;margin:0 0 38px;display:flex;flex-direction:column;row-gap:14px;border:none}.question__text[_ngcontent-%COMP%]{margin:0 0 35px;font-size:1.125rem;text-align:center}.question__btn-wrapper[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:flex-end;column-gap:8px}.preloader[_ngcontent-%COMP%]{width:100vw;height:100vh;position:absolute;top:0;left:0}.preloader__wrapper[_ngcontent-%COMP%]{width:100%;height:100%;position:relative}.preloader__img[_ngcontent-%COMP%]{width:100%;height:100%;background-image:url(jonathan-borba-lrQPTQs7nQQ-unsplash.421b43e11ee48a80.jpg);background-position:center center;background-repeat:no-repeat;background-size:cover;filter:brightness(.5)}.preloader__title[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-family:Jost-Bold,Arial,sans-serif;font-size:3.087rem;line-height:4.438rem;text-align:center;color:#fff}"],changeDetection:0})}return o})()}}]);